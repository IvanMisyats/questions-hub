@* Static SSR - uses HttpContext for authentication state *@

@if (_isAuthenticated)
{
    <div class="dropdown">
        <button class="btn dropdown-toggle user-menu-btn" type="button" id="userMenuDropdown" data-bs-toggle="dropdown" aria-expanded="false" title="@_userName">
            <Icon Name="person-circle" Size="22" />
        </button>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenuDropdown">
            <li>
                <div class="user-menu-header">
                    <div class="user-name">@_userName</div>
                    <div class="user-email">@_userEmail</div>
                </div>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="/Account/Profile">Профіль</a></li>
            <li><hr class="dropdown-divider"></li>
            <li>
                <form method="post" action="/api/Auth/logout">
                    <button type="submit" class="dropdown-item user-menu-logout">Вийти</button>
                </form>
            </li>
        </ul>
    </div>
}
else
{
    <a href="/Account/Login" class="btn btn-primary me-2">Увійти</a>
    <a href="/Account/Register" class="btn btn-outline-primary">Реєстрація</a>
}

@code {
    [CascadingParameter]
    private HttpContext? HttpContext { get; set; }

    private bool _isAuthenticated;
    private bool _isEditor;
    private bool _isAdmin;
    private string _userName = "Користувач";
    private string _userEmail = "";

    protected override void OnInitialized()
    {
        var user = HttpContext?.User;
        _isAuthenticated = user?.Identity?.IsAuthenticated ?? false;

        if (_isAuthenticated && user != null)
        {
            _isAdmin = user.IsInRole("Admin");
            _isEditor = user.IsInRole("Editor");

            _userEmail = user.Identity?.Name ?? "";

            // Get name from claims (added during login)
            var firstName = user.FindFirst("FirstName")?.Value;
            var lastName = user.FindFirst("LastName")?.Value;

            if (!string.IsNullOrEmpty(firstName) || !string.IsNullOrEmpty(lastName))
            {
                _userName = $"{firstName} {lastName}".Trim();
            }
            else
            {
                _userName = _userEmail;
            }
        }
    }
}

