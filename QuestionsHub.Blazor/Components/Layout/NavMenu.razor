<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">
            <img src="images/icon.png" alt="Що?Де?Коли?" width="32" height="32" />
            <span class="brand-text">
                <span class="brand-name">Що?Де?Коли?</span>
                <span class="brand-sub">База запитань</span>
            </span>
        </a>
    </div>
</div>

<div class="nav-scrollable" onclick="closeMobileSidebar()">
    <nav class="nav flex-column">
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                <Icon Name="home" Class="nav-icon" /> <span class="nav-text">Додому</span>
            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="search">
                <Icon Name="search" Class="nav-icon" /> <span class="nav-text">Пошук</span>
            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="editors">
                <Icon Name="group" Class="nav-icon" /> <span class="nav-text">Автори</span>
            </NavLink>
        </div>
        @if (_isEditor || _isAdmin)
        {
            <div class="nav-separator"></div>
            <div class="nav-item px-3">
                <NavLink class="nav-link" href="manage/packages">
                    <Icon Name="folder" Class="nav-icon" /> <span class="nav-text">Мої пакети</span>
                </NavLink>
            </div>
            <div class="nav-item px-3">
                <NavLink class="nav-link" href="admin/editors">
                    <Icon Name="person-badge" Class="nav-icon" /> <span class="nav-text">Редактори</span>
                </NavLink>
            </div>
        }
        @if (_isAdmin)
        {
            <div class="nav-item px-3">
                <NavLink class="nav-link" href="admin/users">
                    <Icon Name="person-gear" Class="nav-icon" /> <span class="nav-text">Користувачі</span>
                </NavLink>
            </div>
        }
    </nav>
    <div class="sidebar-collapse-toggle px-3">
        <button class="collapse-btn" onclick="event.stopPropagation(); toggleSidebarCollapse();" title="Згорнути/Розгорнути">
            <Icon Name="chevron-left" Class="nav-icon collapse-icon" /> <span class="nav-text">Згорнути</span>
        </button>
    </div>
</div>

@code {
    [CascadingParameter]
    private HttpContext? HttpContext { get; set; }

    private bool _isEditor;
    private bool _isAdmin;

    protected override void OnInitialized()
    {
        var user = HttpContext?.User;
        if (user?.Identity?.IsAuthenticated == true)
        {
            _isAdmin = user.IsInRole("Admin");
            _isEditor = user.IsInRole("Editor");
        }
    }
}
