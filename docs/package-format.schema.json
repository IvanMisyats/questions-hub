{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://questions.com.ua/schemas/package-format/1.0",
  "title": "Questions Hub Package Format",
  "description": "Interchange format for Що?Де?Коли? question packages (v1.0)",
  "type": "object",
  "required": ["formatVersion", "title", "tours"],
  "properties": {
    "formatVersion": {
      "type": "string",
      "const": "1.0",
      "description": "Format version. Must be \"1.0\"."
    },
    "sourceUrl": {
      "type": "string",
      "format": "uri",
      "description": "URL where the package was originally obtained."
    },
    "title": {
      "type": "string",
      "minLength": 1,
      "maxLength": 500,
      "description": "Package title."
    },
    "description": {
      "type": "string",
      "maxLength": 2000,
      "description": "Package description or notes."
    },
    "preamble": {
      "type": "string",
      "description": "Preamble — testers, acknowledgements, etc."
    },
    "playedFrom": {
      "type": "string",
      "format": "date",
      "description": "Start date when the package was played (ISO 8601 YYYY-MM-DD)."
    },
    "playedTo": {
      "type": "string",
      "format": "date",
      "description": "End date when the package was played. Omit for single-day events."
    },
    "numberingMode": {
      "type": "string",
      "enum": ["Global", "PerTour", "Manual"],
      "description": "How question numbers are assigned. Global = sequential across tours; PerTour = restart per tour; Manual = non-standard numbering."
    },
    "sharedEditors": {
      "type": "boolean",
      "default": false,
      "description": "When true, editors are defined at package level and shared across all tours."
    },
    "editors": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 1
      },
      "description": "Package-level editors (\"FirstName LastName\"). Meaningful when sharedEditors is true."
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 1,
        "maxLength": 100
      },
      "description": "Tag labels associated with the package."
    },
    "tours": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/tour" },
      "description": "Tours ordered by display order. Array index determines ordering."
    }
  },
  "additionalProperties": false,

  "$defs": {
    "tour": {
      "type": "object",
      "required": ["number"],
      "properties": {
        "number": {
          "type": "string",
          "minLength": 1,
          "maxLength": 50,
          "description": "Display number (\"0\" for warmup, \"1\", \"2\", …)."
        },
        "isWarmup": {
          "type": "boolean",
          "default": false,
          "description": "Whether this is a warmup tour. At most one per package."
        },
        "isShootout": {
          "type": "boolean",
          "default": false,
          "description": "Whether this is a shootout (Перестрілка) tour. At most one per package. Always last."
        },
        "editors": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "description": "Tour editors (\"FirstName LastName\")."
        },
        "preamble": {
          "type": "string",
          "description": "Tour preamble text."
        },
        "comment": {
          "type": "string",
          "maxLength": 2000,
          "description": "Tour-level commentary."
        },
        "questions": {
          "type": "array",
          "items": { "$ref": "#/$defs/question" },
          "description": "Questions directly under the tour (outside blocks)."
        },
        "blocks": {
          "type": "array",
          "items": { "$ref": "#/$defs/block" },
          "description": "Optional blocks within the tour. Array index determines ordering."
        }
      },
      "anyOf": [
        { "required": ["questions"], "properties": { "questions": { "minItems": 1 } } },
        { "required": ["blocks"], "properties": { "blocks": { "minItems": 1 } } }
      ],
      "additionalProperties": false
    },

    "block": {
      "type": "object",
      "required": ["questions"],
      "properties": {
        "name": {
          "type": "string",
          "maxLength": 200,
          "description": "Block name. If omitted, displayed as \"Блок N\"."
        },
        "editors": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "description": "Block editors (\"FirstName LastName\")."
        },
        "preamble": {
          "type": "string",
          "description": "Block preamble text."
        },
        "questions": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/question" },
          "description": "Questions within the block. Array index determines ordering."
        }
      },
      "additionalProperties": false
    },

    "question": {
      "type": "object",
      "required": ["number", "text", "answer"],
      "properties": {
        "number": {
          "type": "string",
          "minLength": 1,
          "maxLength": 20,
          "description": "Display number (\"1\", \"13\", \"F\", etc.)."
        },
        "hostInstructions": {
          "type": "string",
          "maxLength": 1000,
          "description": "Instructions for the host — not read to players."
        },
        "handoutText": {
          "type": "string",
          "description": "Text portion of handout material."
        },
        "handoutAssetFileName": {
          "type": "string",
          "description": "Filename of handout media in the assets/ folder.",
          "pattern": "^[^/\\\\]+$"
        },
        "handoutAssetUrl": {
          "type": "string",
          "format": "uri",
          "description": "External URL for handout media."
        },
        "text": {
          "type": "string",
          "minLength": 1,
          "description": "Main question text."
        },
        "answer": {
          "type": "string",
          "minLength": 1,
          "maxLength": 1000,
          "description": "Correct answer."
        },
        "acceptedAnswers": {
          "type": "string",
          "maxLength": 1000,
          "description": "Alternative accepted answers (залік)."
        },
        "rejectedAnswers": {
          "type": "string",
          "maxLength": 1000,
          "description": "Explicitly rejected answers (незалік)."
        },
        "comment": {
          "type": "string",
          "description": "Commentary explaining the answer."
        },
        "commentAssetFileName": {
          "type": "string",
          "description": "Filename of comment media in the assets/ folder.",
          "pattern": "^[^/\\\\]+$"
        },
        "commentAssetUrl": {
          "type": "string",
          "format": "uri",
          "description": "External URL for comment media."
        },
        "source": {
          "type": "string",
          "description": "Source references for question facts."
        },
        "authors": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "description": "Question authors (\"FirstName LastName\")."
        }
      },
      "additionalProperties": false
    }
  }
}
